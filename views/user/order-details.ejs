<%- include("../partials/users/header.ejs") %>
<div class="flex min-h-screen">
<%- include("../partials/users/sidebar.ejs") %> 

<div class="page-container w-full">
    <main class="main-content w-full">
        <div class="bg-white p-6 rounded-lg shadow-sm animate-fade-in-up w-full">
            <h1 class="text-2xl font-semibold mb-4">My Orders</h1>
            <% if (orders && orders.length > 0) { %>
                <div class="overflow-x-auto w-full">
                    <% orders.forEach(function(order) { %>
                        <div class="border border-gray-200 rounded-md p-4 mb-4 transition-all duration-300 hover:shadow-md w-full">
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse text-sm">
                                    <thead>
                                        <tr>
                                            <th class="py-3 px-3 text-left bg-gray-50 font-medium text-gray-600 border-b border-gray-200">Order ID</th>
                                            <th class="py-3 px-3 text-left bg-gray-50 font-medium text-gray-600 border-b border-gray-200">Date</th>
                                            <th class="py-3 px-3 text-left bg-gray-50 font-medium text-gray-600 border-b border-gray-200">Action</th>
                                            <th class="py-3 px-3 text-left bg-gray-50 font-medium text-gray-600 border-b border-gray-200">Invoice</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="py-3 px-3 border-b border-gray-200">#<%= order._id %></td>
                                            <td class="py-3 px-3 border-b border-gray-200"><%= new Date(order.date).toLocaleDateString() %></td>
                                            <td class="py-3 px-3 border-b border-gray-200">
                                                <% if (order.paymentMethod === 'Online Payment' && order.paymentStatus === 'pending') { %>
                                                    <button onclick="retryPayment('<%= order.razorpayOrderId %>')" class="bg-indigo-600 text-white px-3 py-1.5 rounded text-sm hover:bg-indigo-700 transition-colors duration-200">Retry</button>
                                                <% } else { %>
                                                    <a href="/orderStatus/<%= order._id %>" class="bg-indigo-600 text-white px-3 py-1.5 rounded text-sm hover:bg-indigo-700 transition-colors duration-200">View</a>
                                                <% } %>
                                            </td>
                                            <td class="py-3 px-3 border-b border-gray-200">
                                                <% let invoiceShown = false; %>
                                                <% order.orderedItem.forEach(item => { %>
                                                    <% if (item.productStatus === 'delivered' && !invoiceShown) { %>
                                                        <a href="/downloadInvoice/<%= order._id %>" class="bg-black text-white px-2 py-1.5 rounded text-xs hover:bg-gray-800 transition-colors duration-200">Download</a>
                                                        <% invoiceShown = true; %>
                                                    <% } %>
                                                <% }) %>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="text-right font-medium text-gray-800 mt-2 text-sm">
                                Total: ₹<%= order.finalAmount.toFixed(2) %>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <% if (totalPages > 1) { %>
                    <div class="flex justify-center gap-2 mt-6">
                        <% if (currentPage > 1) { %>
                            <a href="?page=<%= currentPage - 1 %>" class="px-3 py-1.5 border border-gray-200 rounded text-gray-600 text-sm hover:bg-gray-50 transition-colors duration-200">← Previous</a>
                        <% } %>
                        
                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <a href="?page=<%= i %>" 
                               class="px-3 py-1.5 border rounded text-sm <%= currentPage === i ? 'bg-indigo-600 text-white border-indigo-600' : 'text-gray-600 border-gray-200 hover:bg-gray-50' %> transition-colors duration-200">
                                <%= i %>
                            </a>
                        <% } %>
                        
                        <% if (currentPage < totalPages) { %>
                            <a href="?page=<%= currentPage + 1 %>" class="px-3 py-1.5 border border-gray-200 rounded text-gray-600 text-sm hover:bg-gray-50 transition-colors duration-200">Next →</a>
                        <% } %>
                    </div>
                <% } %>
            <% } else { %>
                <p class="text-gray-500">No orders found.</p>
            <% } %>
        </div>
    </main>
</div>
</div>
<!-- Add Tailwind animations -->
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 0.5s ease-out forwards;
    }
    
    svg {
        width: 100% !important;
    }
    
    .page-container {
        width: 100%;
        max-width: 100%;
        padding-left: 13px;
        padding-right: 0;
    }
    
    .main-content {
        width: 100%;
        max-width: 100%;
    }
</style>

<%- include("../partials/users/footer.ejs") %>